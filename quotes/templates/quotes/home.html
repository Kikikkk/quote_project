{% extends 'quotes/base.html' %}

{% block title %}–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞{% endblock %}

{% block content %}
<h1 class="mb-4">–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</h1>

{% if quote %}
    <div class="card mb-3">
        <div class="card-body">
            <blockquote class="blockquote mb-2">
                {{ quote.text }}
            </blockquote>
            <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> {{ quote.source }}</p>
            <p><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:</strong> {{ quote.views }}</p>

            <div>
                <button class="btn btn-success me-2" onclick="vote('like')">üëç <span id="like-count">{{ quote.likes }}</span></button>
                <button class="btn btn-danger" onclick="vote('dislike')">üëé <span id="dislike-count">{{ quote.dislikes }}</span></button>
            </div>
        </div>
    </div>
{% else %}
    <p>–¶–∏—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    function vote(type) {
        const key = `voted_{{ quote.id }}`;
        if (localStorage.getItem(key)) {
            alert("–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –∑–∞ —ç—Ç—É —Ü–∏—Ç–∞—Ç—É.");
            return;
        }

        fetch(`/${type}/{{ quote.id }}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (type === 'like') {
                document.getElementById('like-count').innerText = data.likes;
            } else {
                document.getElementById('dislike-count').innerText = data.dislikes;
            }
            localStorage.setItem(key, type);
        });
    }
</script>
{% endblock %}
